<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Parcelforce by alexpechkarev</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Parcelforce</h1>
        <h2>Parcelforce expressTransfer API for Laravel to generate pre-advice electronic file that required by solution.</h2>
        <a href="https://github.com/alexpechkarev/parcelforce" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="parcelforce-expresstransfer-api-for-laravel-4" class="anchor" href="#parcelforce-expresstransfer-api-for-laravel-4"><span class="octicon octicon-link"></span></a>Parcelforce expressTransfer API for Laravel 4</h1>

<p><a href="http://www.parcelforce.com/"><strong>Parcelforce exrpessTransfer</strong></a>API for <a href="http://laravel.com/"><strong>Laravel</strong></a> to generate pre-advice electronic file that required by solution.</p>

<p><a href="https://travis-ci.org/alexpechkarev/parcelforce"><img src="https://travis-ci.org/alexpechkarev/parcelforce.svg?branch=master" alt="Build Status"></a></p>

<h2>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h2>

<ul>
<li>Generating electronic file on the server</li>
<li>Submitting electronic file to <a href="http://www.parcelforce.com/"><strong>Parcelforce</strong></a>
</li>
<li>Single or multiply consignment's per file</li>
<li>UK Domestic collection request (Label and receipt provided by PFW driver) </li>
<li>UK Domestic services dispatches only (Label printed by customer)</li>
<li>Can be used as Laravel package or PHP standalone class</li>
</ul><h2>
<a name="requirements" class="anchor" href="#requirements"><span class="octicon octicon-link"></span></a>Requirements</h2>

<p>Must be <a href="http://www.parcelforce.com/account-customer/benefits-of-parcelforce-account"><strong>Parcelforce</strong></a> customer<br>
PHP &gt;= 5.3<br>
MySQL<br><a href="http://laravel.com/"><strong>Laravel</strong></a> &gt;= 4.1 if used as Laravel package</p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<div class="highlight highlight-sh"><pre>composer require alexpechkarev/parcelforce  dev-master
</pre></div>

<h2>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>Once installed, register Laravel service provider, in <code>app/config/app.php</code>:</p>

<div class="highlight highlight-php"><pre><span class="s1">'providers'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="o">...</span>
    <span class="s1">'Parcelforce\ExpressTransfer\ParcelforceServiceProvider'</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

<p>Publish configuration file:</p>

<div class="highlight highlight-sh"><pre>php artisan config:publish parcelforce/expresstransfer --path vendor/alexpechkarev/parcelforce/src/config/
</pre></div>

<p>All generated file will be stored in <code>app/config/packages/parcelforce/expresstransfer/files</code> folder by default. 
Ensure this folder writable by the web server:</p>

<div class="highlight highlight-sh"><pre>chmod o+w app/config/packages/parcelforce/expresstransfer/files
</pre></div>

<p>Name and location of this folder can be specified in the configuration file by editing <code>filePath</code> value, 
if changed ensure it's writable by we server.</p>

<div class="highlight highlight-php"><pre>    <span class="sd">/**</span>
<span class="sd">     * Location consignment files</span>
<span class="sd">     */</span>        
    <span class="s1">'filePath'</span>                        <span class="o">=&gt;</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">'/files/'</span><span class="p">,</span>
</pre></div>

<p>In the configuration file <code>app/config/packages/parcelforce/expresstransfer/config.php</code> please ensure that following parameters are set. 
For more details on configuration options and required values please contact <a href="http://www.parcelforce.com/contact-us"><strong>Parcelforce</strong></a>.
By default these parameters preset with dummy values.</p>

<pre><code> 'header_customer_account' 
 'header_generic_contract'
 'senderName'
 'senderAddress1'
 'senderPostTown'
 'senderPostcode'
 'dr_consignment_number' 
 'fileName' 
 'ftpUser' 
 'ftpPass'
 'ftpUploadPath'
 'ftpLocationPath'
</code></pre>

<h2>
<a name="laravel-usage" class="anchor" href="#laravel-usage"><span class="octicon octicon-link"></span></a>Laravel Usage</h2>

<p>Simply pass you data as array to <code>Parcelforce::process()</code> method. Electronic file will be generated for given data, 
stored at <code>filePath</code> location and submitted to Parcelforce. </p>

<div class="highlight highlight-php"><pre>        <span class="nv">$senderData</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s2">"deliveryDetails"</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span>
                    <span class="s1">'receiverName'</span>      <span class="o">=&gt;</span><span class="s2">"MR CUSTOMER"</span><span class="p">,</span>
                    <span class="s1">'receiverAddress1'</span>  <span class="o">=&gt;</span><span class="s1">'100 CUSTOMER SOLUTIONS STREET'</span><span class="p">,</span>
                    <span class="s1">'receiverPostTown'</span>  <span class="o">=&gt;</span><span class="s1">'MILTON KEYNES'</span><span class="p">,</span>
                    <span class="s1">'receiverPostcode'</span>  <span class="o">=&gt;</span><span class="s1">'MK9 9AB'</span>
                    <span class="p">)</span>
            <span class="p">)</span>           
        <span class="p">);</span>

        <span class="nx">Parcelforce</span><span class="o">::</span><span class="na">process</span><span class="p">(</span><span class="nv">$senderData</span><span class="p">);</span>

        <span class="c1">// generate file locally without submitting to Parcelforce</span>
        <span class="nx">Parcelforce</span><span class="o">::</span><span class="na">process</span><span class="p">(</span><span class="nv">$senderData</span><span class="p">,</span> <span class="k">FALSE</span><span class="p">);</span>
</pre></div>

<p>Multiply consignment data can be submitted in single request.</p>

<div class="highlight highlight-php"><pre>        <span class="nv">$senderData</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s2">"deliveryDetails"</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span>
                    <span class="s1">'receiverName'</span>      <span class="o">=&gt;</span><span class="s2">"MR CUSTOMER"</span><span class="p">,</span>
                    <span class="s1">'receiverAddress1'</span>  <span class="o">=&gt;</span><span class="s1">'100 CUSTOMER SOLUTIONS STREET'</span><span class="p">,</span>
                    <span class="s1">'receiverPostTown'</span>  <span class="o">=&gt;</span><span class="s1">'MILTON KEYNES'</span><span class="p">,</span>
                    <span class="s1">'receiverPostcode'</span>  <span class="o">=&gt;</span><span class="s1">'MK9 9AB'</span>
                    <span class="p">)</span>
            <span class="p">),</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s2">"deliveryDetails"</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span>
                    <span class="s1">'receiverName'</span>      <span class="o">=&gt;</span><span class="s2">"MR CUSTOMER"</span><span class="p">,</span>
                    <span class="s1">'receiverAddress1'</span>  <span class="o">=&gt;</span><span class="s1">'202 CUSTOMER SOLUTIONS STREET'</span><span class="p">,</span>
                    <span class="s1">'receiverPostTown'</span>  <span class="o">=&gt;</span><span class="s1">'MILTON KEYNES'</span><span class="p">,</span>
                    <span class="s1">'receiverPostcode'</span>  <span class="o">=&gt;</span><span class="s1">'MK9 9AB'</span>
                    <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">);</span>

        <span class="nx">Parcelforce</span><span class="o">::</span><span class="na">process</span><span class="p">(</span><span class="nv">$senderData</span><span class="p">);</span>
</pre></div>

<p>By default collection date is set for tomorrow's date and can be amended in the configuration file, see <code>collectionDate</code>.
This value can also be specified at runtime using <code>Parcelforce::setDate()</code> method.</p>

<div class="highlight highlight-php"><pre>    <span class="nx">Parcelforce</span><span class="o">::</span><span class="na">setDate</span><span class="p">(</span><span class="s2">"next Monday"</span><span class="p">);</span>
    <span class="nx">Parcelforce</span><span class="o">::</span><span class="na">process</span><span class="p">(</span><span class="nv">$senderData</span><span class="p">);</span>
</pre></div>

<p>Dates handled by:</p>

<ul>
<li>
<a href="https://github.com/briannesbitt/Carbon"><strong>Carbon</strong></a> in package for Laravel</li>
<li>
<a href="http://php.net/manual/en/book.datetime.php"><strong>DateTime</strong></a> in PHP standalone class<br>
</li>
</ul><p>Following formats accepted by <code>setDate()</code> method:</p>

<p><a href="http://php.net/manual/en/datetime.formats.relative.php"><strong>Relative Formats</strong></a></p>

<ul>
<li>tomorrow</li>
<li>next wednesday</li>
<li>this thursday</li>
<li>....</li>
</ul><p><a href="http://php.net/manual/en/datetime.formats.date.php"><strong>Date Formats</strong></a></p>

<ul>
<li>2014-08-11</li>
<li>08/11/2014</li>
<li>20140811</li>
<li>....</li>
</ul><h2>
<a name="php-standalone-class-usage" class="anchor" href="#php-standalone-class-usage"><span class="octicon octicon-link"></span></a>PHP standalone class Usage</h2>

<p>Location: 'Parcelforce\ExpressTransfer\PHP\'</p>

<p>Standalone class have same methods as Laravel package and accepts consignment data in the same way.
Before use please ensure that required parameters are set in configuration file 'Parcelforce/ExpressTransfer/PHP/config.php' and
<code>Parcelforce/ExpressTransfer/PHP/files</code> folder is writable by web server.</p>

<div class="highlight highlight-php"><pre>       <span class="nv">$pf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Parcelforce\ExpressTransfer\PHP\Parcelforce</span><span class="p">();</span>
       <span class="nv">$pf</span><span class="o">-&gt;</span><span class="na">process</span><span class="p">(</span><span class="nv">$senderData</span><span class="p">));</span>

       <span class="c1">// generate file locally without submitting to Parcelforce</span>
       <span class="nv">$pf</span><span class="o">-&gt;</span><span class="na">process</span><span class="p">(</span><span class="nv">$senderData</span><span class="p">));</span>
</pre></div>

<p><code>setDate()</code> method is also available in standalone version.</p>

<div class="highlight highlight-php"><pre>    <span class="o">...</span>
    <span class="nv">$pf</span><span class="o">-&gt;</span><span class="na">setDate</span><span class="p">(</span><span class="s2">"next Monday"</span><span class="p">);</span>
    <span class="nv">$pf</span><span class="o">-&gt;</span><span class="na">process</span><span class="p">(</span><span class="nv">$senderData</span><span class="p">);</span>
</pre></div>

<h2>
<a name="configuration-testing" class="anchor" href="#configuration-testing"><span class="octicon octicon-link"></span></a>Configuration testing</h2>

<p>For testing and configuration purposes file can be generated without being submitted to Parcelforce.
To generate file locally simply pass <code>FALSE</code> as second parameter to <code>process()</code> method.</p>

<div class="highlight highlight-php"><pre>    <span class="c1">// In Laravel package</span>
    <span class="nx">Parcelforce</span><span class="o">::</span><span class="na">process</span><span class="p">(</span><span class="nv">$senderData</span><span class="p">,</span> <span class="k">FALSE</span><span class="p">);</span>

    <span class="c1">// In PHP standalone class</span>
    <span class="nv">$pf</span><span class="o">-&gt;</span><span class="na">process</span><span class="p">(</span><span class="nv">$senderData</span><span class="p">,</span> <span class="k">FALSE</span><span class="p">);</span>
</pre></div>

<p>Once testing and configuration completed file and consignment numbers have to be reset to initial values.
To initiate process call <code>reset()</code> method. 
Please note: <code>reset()</code> will reload database tables and all the data will be lost.
See <code>config.php</code> for table details.</p>

<div class="highlight highlight-php"><pre>    <span class="c1">// In Laravel package</span>
    <span class="nx">Parcelforce</span><span class="o">::</span><span class="na">reset</span><span class="p">();</span>

    <span class="c1">// In PHP standalone class</span>
    <span class="nv">$pf</span><span class="o">-&gt;</span><span class="na">reset</span><span class="p">();</span>
</pre></div>

<h2>
<a name="phpunit-testing" class="anchor" href="#phpunit-testing"><span class="octicon octicon-link"></span></a>PHPUnit Testing</h2>

<p>PHPUnit testing require <a href="https://github.com/padraic/mockery"><strong>Mockery</strong></a> flexible PHP mock object framework.
Run following command to install Mockery:</p>

<pre><code>composer require mockery/mockery:dev-master@dev
</code></pre>

<p>In Laravel package test file needs copying from package folder into <code>app/tests/</code> folder, use following to do so:</p>

<pre><code>cp vendor/alexpechkarev/parcelforce/tests/ParcelforceLaravelTest.txt app/tests/ParcelforceTest.php
</code></pre>

<p>And then run test:</p>

<div class="highlight highlight-sh"><pre>phpunit app/tests/ParcelforceTest.php
</pre></div>

<p>To test PHP standalone file ensure database credentials are set in the config file.</p>

<div class="highlight highlight-sh"><pre>    phpunit vendor/alexpechkarev/parcelforce/tests/ParcelforcePHPTest.php
</pre></div>

<h2>
<a name="main-methods" class="anchor" href="#main-methods"><span class="octicon octicon-link"></span></a>Main Methods</h2>

<div class="highlight highlight-php"><pre>     <span class="sd">/** </span>
<span class="sd">     * @param array $data - array of data</span>
<span class="sd">     * @return string File content</span>
<span class="sd">     */</span>
     <span class="k">public</span> <span class="k">function</span> <span class="nf">process</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$upload</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">)</span>


    <span class="sd">/**</span>
<span class="sd">     * Drop database tables</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">reset</span><span class="p">()</span>



    <span class="sd">/**</span>
<span class="sd">     * Get file content</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
     <span class="k">public</span> <span class="k">function</span> <span class="nf">getFileContent</span><span class="p">()</span>


    <span class="sd">/**</span>
<span class="sd">     * Get current instance config file</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getConfig</span><span class="p">()</span>
</pre></div>

<h2>
<a name="support" class="anchor" href="#support"><span class="octicon octicon-link"></span></a>Support</h2>

<p><a href="https://github.com/alexpechkarev/parcelforce/issues">Please open an issue on GitHub</a></p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>Parcelforce expressTransfer API for Laravel 4 is released under the MIT License. See the bundled
<a href="https://github.com/alexpechkarev/parcelforce/blob/master/LICENSE">LICENSE</a>
file for details.</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/alexpechkarev/parcelforce/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/alexpechkarev/parcelforce/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/alexpechkarev/parcelforce"></a> is maintained by <a href="https://github.com/alexpechkarev">alexpechkarev</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-53835874-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>